-- Astral Projection & Player Mimic Script
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Create GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AstralProjectionGUI"
screenGui.ResetOnSpawn = false

-- Main frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 350, 0, 400)
mainFrame.Position = UDim2.new(0, 100, 0, 100)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

-- Title bar
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 40)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(0.7, 0, 1, 0)
title.Position = UDim2.new(0.05, 0, 0, 0)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Text = "üåå Astral Projection"
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = titleBar

-- Close button
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 25, 0, 25)
closeButton.Position = UDim2.new(0.9, 0, 0.2, 0)
closeButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Text = "X"
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 14
closeButton.Parent = titleBar

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 4)
closeCorner.Parent = closeButton

-- Content frame
local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, 0, 1, -40)
contentFrame.Position = UDim2.new(0, 0, 0, 40)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- Astral Projection Section
local astralLabel = Instance.new("TextLabel")
astralLabel.Size = UDim2.new(0.9, 0, 0, 25)
astralLabel.Position = UDim2.new(0.05, 0, 0.02, 0)
astralLabel.BackgroundTransparency = 1
astralLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
astralLabel.Text = "ASTRAL PROJECTION:"
astralLabel.Font = Enum.Font.GothamBold
astralLabel.TextSize = 14
astralLabel.TextXAlignment = Enum.TextXAlignment.Left
astralLabel.Parent = contentFrame

local projectButton = Instance.new("TextButton")
projectButton.Size = UDim2.new(0.9, 0, 0, 45)
projectButton.Position = UDim2.new(0.05, 0, 0.1, 0)
projectButton.BackgroundColor3 = Color3.fromRGB(80, 160, 255)
projectButton.TextColor3 = Color3.fromRGB(255, 255, 255)
projectButton.Text = "üöÄ PROJECT ASTRAL BODY"
projectButton.Font = Enum.Font.GothamBold
projectButton.TextSize = 14
projectButton.Parent = contentFrame

local projectCorner = Instance.new("UICorner")
projectCorner.CornerRadius = UDim.new(0, 6)
projectCorner.Parent = projectButton

local unprojectButton = Instance.new("TextButton")
unprojectButton.Size = UDim2.new(0.9, 0, 0, 35)
unprojectButton.Position = UDim2.new(0.05, 0, 0.22, 0)
unprojectButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
unprojectButton.TextColor3 = Color3.fromRGB(255, 255, 255)
unprojectButton.Text = "üîô RETURN TO BODY"
unprojectButton.Font = Enum.Font.GothamBold
unprojectButton.TextSize = 12
unprojectButton.Parent = contentFrame

local unprojectCorner = Instance.new("UICorner")
unprojectCorner.CornerRadius = UDim.new(0, 6)
unprojectCorner.Parent = unprojectButton

-- Player Mimic Section
local mimicLabel = Instance.new("TextLabel")
mimicLabel.Size = UDim2.new(0.9, 0, 0, 25)
mimicLabel.Position = UDim2.new(0.05, 0, 0.38, 0)
mimicLabel.BackgroundTransparency = 1
mimicLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
mimicLabel.Text = "PLAYER MIMICRY:"
mimicLabel.Font = Enum.Font.GothamBold
mimicLabel.TextSize = 14
mimicLabel.TextXAlignment = Enum.TextXAlignment.Left
mimicLabel.Parent = contentFrame

local mimicButton = Instance.new("TextButton")
mimicButton.Size = UDim2.new(0.9, 0, 0, 45)
mimicButton.Position = UDim2.new(0.05, 0, 0.46, 0)
mimicButton.BackgroundColor3 = Color3.fromRGB(255, 170, 80)
mimicButton.TextColor3 = Color3.fromRGB(255, 255, 255)
mimicButton.Text = "üé≠ MIMIC RANDOM PLAYER"
mimicButton.Font = Enum.Font.GothamBold
mimicButton.TextSize = 14
mimicButton.Parent = contentFrame

local mimicCorner = Instance.new("UICorner")
mimicCorner.CornerRadius = UDim.new(0, 6)
mimicCorner.Parent = mimicButton

local unmimicButton = Instance.new("TextButton")
unmimicButton.Size = UDim2.new(0.9, 0, 0, 35)
unmimicButton.Position = UDim2.new(0.05, 0, 0.58, 0)
unmimicButton.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
unmimicButton.TextColor3 = Color3.fromRGB(255, 255, 255)
unmimicButton.Text = "üë§ RETURN TO SELF"
unmimicButton.Font = Enum.Font.GothamBold
unmimicButton.TextSize = 12
unmimicButton.Parent = contentFrame

local unmimicCorner = Instance.new("UICorner")
unmimicCorner.CornerRadius = UDim.new(0, 6)
unmimicCorner.Parent = unmimicButton

-- Status label
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(0.9, 0, 0, 80)
statusLabel.Position = UDim2.new(0.05, 0, 0.72, 0)
statusLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
statusLabel.Text = "Status: Ready\nClick buttons to test functions"
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextSize = 12
statusLabel.TextWrapped = true
statusLabel.Parent = contentFrame

local statusCorner = Instance.new("UICorner")
statusCorner.CornerRadius = UDim.new(0, 6)
statusCorner.Parent = statusLabel

-- Insert GUI
if gethui then
    screenGui.Parent = gethui()
elseif syn and syn.protect_gui then
    syn.protect_gui(screenGui)
    screenGui.Parent = game:GetService("CoreGui")
else
    screenGui.Parent = game:GetService("CoreGui")
end

-- Variables
local localPlayer = Players.LocalPlayer

-- Astral Projection Variables
local isAstral = false
local originalCFrame = nil
local astralBody = nil
local skeletonParts = {}

-- Function to create simple astral effect
local function createAstralEffect()
    local character = localPlayer.Character
    if not character then return end
    
    -- Store original position
    local root = character:FindFirstChild("HumanoidRootPart")
    if root then
        originalCFrame = root.CFrame
    end
    
    -- Create transparent effect on character
    for _, part in pairs(character:GetChildren()) do
        if part:IsA("BasePart") then
            part.Transparency = 0.8
            part.Material = Enum.Material.Neon
            part.BrickColor = BrickColor.new("Cyan")
            
            -- Store original properties
            skeletonParts[part] = {
                Transparency = part.Transparency,
                Material = part.Material,
                Color = part.BrickColor
            }
        end
    end
    
    statusLabel.Text = "‚úÖ Astral Projection Active!\n‚Ä¢ You appear ghostly to others\n‚Ä¢ You can move normally\n‚Ä¢ Click RETURN TO BODY to revert"
end

-- Function to remove astral effect
local function removeAstralEffect()
    local character = localPlayer.Character
    if not character then return end
    
    -- Restore original appearance
    for part, originalProps in pairs(skeletonParts) do
        if part and part.Parent then
            part.Transparency = originalProps.Transparency
            part.Material = originalProps.Material
            part.BrickColor = originalProps.Color
        end
    end
    
    skeletonParts = {}
    statusLabel.Text = "‚úÖ Returned to normal body!"
end

-- Function to mimic player appearance
local function mimicRandomPlayer()
    local players = Players:GetPlayers()
    local targetPlayer = nil
    
    -- Find a random player that's not yourself
    for _, player in pairs(players) do
        if player ~= localPlayer and player.Character then
            targetPlayer = player
            break
        end
    end
    
    if not targetPlayer then
        statusLabel.Text = "‚ùå No other players found to mimic"
        return
    end
    
    local targetChar = targetPlayer.Character
    local localChar = localPlayer.Character
    
    if not targetChar or not localChar then
        statusLabel.Text = "‚ùå Characters not loaded"
        return
    end
    
    -- Simple mimic by changing colors
    for _, part in pairs(localChar:GetChildren()) do
        if part:IsA("BasePart") then
            local targetPart = targetChar:FindFirstChild(part.Name)
            if targetPart then
                part.BrickColor = targetPart.BrickColor
                part.Material = targetPart.Material
            end
        end
    end
    
    statusLabel.Text = "‚úÖ Now mimicking " .. targetPlayer.Name .. "!\nAppearance changed to match target player"
end

-- Function to reset appearance
local function resetAppearance()
    local character = localPlayer.Character
    if not character then return end
    
    -- This would normally reset to original appearance
    -- For demo, we'll just make it obvious
    for _, part in pairs(character:GetChildren()) do
        if part:IsA("BasePart") then
            part.BrickColor = BrickColor.new("Bright blue")
            part.Material = Enum.Material.Plastic
        end
    end
    
    statusLabel.Text = "‚úÖ Returned to normal appearance!"
end

-- Connect button events with proper error handling
projectButton.MouseButton1Click:Connect(function()
    if isAstral then
        statusLabel.Text = "‚ùå Already in astral form!"
        return
    end
    
    local success, errorMsg = pcall(function()
        createAstralEffect()
        isAstral = true
        projectButton.BackgroundColor3 = Color3.fromRGB(60, 140, 220)
        unprojectButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
    end)
    
    if not success then
        statusLabel.Text = "‚ùå Error with astral projection: " .. tostring(errorMsg)
    end
end)

unprojectButton.MouseButton1Click:Connect(function()
    if not isAstral then
        statusLabel.Text = "‚ùå Not in astral form!"
        return
    end
    
    local success, errorMsg = pcall(function()
        removeAstralEffect()
        isAstral = false
        projectButton.BackgroundColor3 = Color3.fromRGB(80, 160, 255)
        unprojectButton.BackgroundColor3 = Color3.fromRGB(180, 80, 80)
    end)
    
    if not success then
        statusLabel.Text = "‚ùå Error returning to body: " .. tostring(errorMsg)
    end
end)

mimicButton.MouseButton1Click:Connect(function()
    local success, errorMsg = pcall(function()
        mimicRandomPlayer()
        mimicButton.BackgroundColor3 = Color3.fromRGB(220, 150, 60)
        unmimicButton.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
    end)
    
    if not success then
        statusLabel.Text = "‚ùå Error mimicking player: " .. tostring(errorMsg)
    end
end)

unmimicButton.MouseButton1Click:Connect(function()
    local success, errorMsg = pcall(function()
        resetAppearance()
        mimicButton.BackgroundColor3 = Color3.fromRGB(255, 170, 80)
        unmimicButton.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
    end)
    
    if not success then
        statusLabel.Text = "‚ùå Error resetting appearance: " .. tostring(errorMsg)
    end
end)

closeButton.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

-- Handle character respawns
localPlayer.CharacterAdded:Connect(function(character)
    wait(1) -- Wait for character to load
    
    if isAstral then
        -- Re-apply astral effect
        wait(0.5)
        createAstralEffect()
    end
end)

statusLabel.Text = "‚úÖ GUI Loaded Successfully!\nButtons are now functional\nTest each feature below"

print("üéÆ Astral Projection GUI loaded!")
print("‚ú® Buttons should now work:")
print("   ‚Ä¢ PROJECT ASTRAL BODY - Makes you transparent")
print("   ‚Ä¢ RETURN TO BODY - Returns to normal")
print("   ‚Ä¢ MIMIC RANDOM PLAYER - Copies another player's colors")
print("   ‚Ä¢ RETURN TO SELF - Resets your appearance")
